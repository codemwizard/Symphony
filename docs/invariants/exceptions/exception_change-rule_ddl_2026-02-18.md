---
exception_id: EXC-20260218-ANCHOR-PR3
inv_scope: change-rule
expiry: 2026-03-04
follow_up_ticket: TSK-P1-040
reason: Auto-generated preflight exception accepted for PR-3 structural migration restore and baseline refresh.
author: system
created_at: 2026-02-18
---

# Exception: ddl structural change without invariants linkage

This exception was auto-generated by local preflight because a structural change was detected,
but invariants linkage (manifest/docs with INV-###) was not included in the same commit.

## Reason

This commit restores previously deleted anchor-sync operational migrations as forward-only files and refreshes deterministic baseline artifacts.
Preflight Rule-1 evaluates structural linkage strictly on same-commit manifest delta, while this batch intentionally restores operational behavior under existing invariant IDs pending dedicated PR-4 verifier wiring.

## Evidence

structural_change: True
confidence_hint: 1.0
primary_reason: ddl
reason_types: ddl, migration_file_added_or_deleted, security

Matched files:
- schema/migrations/0033_anchor_sync_operational_enforcement.sql
- schema/migrations/0034_anchor_sync_operational_fix_append_only_and_lease_time.sql

Top matches:
- ddl | schema/baseline.sql | +: CREATE TABLE public.anchor_sync_operations (
- ddl | schema/baseline.sql | +: CONSTRAINT anchor_sync_operations_attempt_count_check CHECK ((attempt_count >= 0)),
- ddl | schema/baseline.sql | +: CONSTRAINT anchor_sync_operations_state_check CHECK ((state = ANY (ARRAY['PENDING'::text, 'ANCHORING'::text, 'ANCHORED'::text, 'COMPLETED'::text, 'FAILED'::text]))),
- ddl | schema/baseline.sql | +: CONSTRAINT ck_anchor_sync_completed_requires_anchor_ref CHECK (((state <> 'COMPLETED'::text) OR (anchor_ref IS NOT NULL)))
- ddl | schema/baseline.sql | +: ALTER TABLE ONLY public.anchor_sync_operations
- ddl | schema/baseline.sql | +: ADD CONSTRAINT anchor_sync_operations_pack_id_key UNIQUE (pack_id);
- ddl | schema/baseline.sql | +: ALTER TABLE ONLY public.anchor_sync_operations
- ddl | schema/baseline.sql | +: ADD CONSTRAINT anchor_sync_operations_pkey PRIMARY KEY (operation_id);
- ddl | schema/baseline.sql | +: CREATE INDEX idx_anchor_sync_operations_state_due ON public.anchor_sync_operations USING btree (state, lease_expires_at, updated_at);
- ddl | schema/baseline.sql | +: ALTER TABLE ONLY public.anchor_sync_operations
- ddl | schema/baseline.sql | +: ADD CONSTRAINT anchor_sync_operations_pack_id_fkey FOREIGN KEY (pack_id) REFERENCES public.evidence_packs(pack_id);
- security | schema/baselines/2026-02-18/0001_baseline.sql | +: SELECT pg_catalog.set_config('search_path', '', false);
- ddl | schema/baselines/2026-02-18/0001_baseline.sql | +: CREATE TYPE public.outbox_attempt_state AS ENUM (
- ddl | schema/baselines/2026-02-18/0001_baseline.sql | +: CREATE TYPE public.policy_version_status AS ENUM (
- security | schema/baselines/2026-02-18/0001_baseline.sql | +: LANGUAGE plpgsql SECURITY DEFINER
- security | schema/baselines/2026-02-18/0001_baseline.sql | +: SET search_path TO 'pg_catalog', 'public'
- security | schema/baselines/2026-02-18/0001_baseline.sql | +: LANGUAGE sql SECURITY DEFINER
- security | schema/baselines/2026-02-18/0001_baseline.sql | +: SET search_path TO 'pg_catalog', 'public'
- security | schema/baselines/2026-02-18/0001_baseline.sql | +: LANGUAGE plpgsql SECURITY DEFINER
- security | schema/baselines/2026-02-18/0001_baseline.sql | +: SET search_path TO 'pg_catalog', 'public'
- security | schema/baselines/2026-02-18/0001_baseline.sql | +: LANGUAGE plpgsql SECURITY DEFINER
- security | schema/baselines/2026-02-18/0001_baseline.sql | +: SET search_path TO 'pg_catalog', 'public'
- security | schema/baselines/2026-02-18/0001_baseline.sql | +: LANGUAGE plpgsql SECURITY DEFINER
- security | schema/baselines/2026-02-18/0001_baseline.sql | +: SET search_path TO 'pg_catalog', 'public'
- ddl | schema/baselines/2026-02-18/0001_baseline.sql | +: CREATE TABLE public.anchor_sync_operations (

## Mitigation

- Threat/compliance documents were updated in this batch:
  - `docs/architecture/THREAT_MODEL.md`
  - `docs/architecture/COMPLIANCE_MAP.md`
- SQLSTATE registry was updated for anchor-sync codes (`P7210`, `P7211`, `P7212`) in `docs/contracts/sqlstate_map.yml`.
- Baseline artifacts were regenerated via `scripts/db/generate_baseline_snapshot.sh` and drift was validated with `scripts/db/check_baseline_drift.sh`.
- Full `scripts/dev/pre_ci.sh` passed after these updates.
