
> symphony@1.0.0 test:jest
> node --experimental-vm-modules node_modules/jest/bin/jest.js

ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
(node:32675) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS tests/repair-workflow.test.ts (30.269 s)
  Phase 7.2: Repair Workflow
    Repair Guarantees
      ‚úì repair should only advance to terminal state, never regress (86 ms)
      ‚úì repair events should be append-only (16 ms)
    Reconciliation Results
      ‚úì CONFIRMED_SUCCESS should yield COMPLETED transition (8 ms)
      ‚úì CONFIRMED_FAILURE should yield FAILED transition (1 ms)
      ‚úì NOT_FOUND should yield FAILED transition (2 ms)
      ‚úì STILL_PENDING should not yield transition (1 ms)
      ‚úì RAIL_UNAVAILABLE should not yield transition (1 ms)
    Advisory Transition Commands
      ‚úì transition requests are advisory, may be rejected by .NET (9 ms)

ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
{"level":30,"time":1768711330288,"system":"symphony","requestId":"req-001","failureClass":"VALIDATION_FAILURE","retryAllowed":false,"repairRequired":false,"msg":"Failure classified"}
(node:32669) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
PASS tests/failure-classification.test.ts (31.83 s)
  Phase 7.2: Failure Classification
    Failure Class Metadata
      ‚úì VALIDATION_FAILURE should not allow retry (35 ms)
      ‚úì AUTHZ_FAILURE should not allow retry (2 ms)
      ‚úì RAIL_REJECT should not allow retry (1 ms)
      ‚úì TIMEOUT should require repair, not retry (10 ms)
      ‚úì TRANSPORT_ERROR should allow retry (6 ms)
      ‚úì SYSTEM_FAILURE should allow retry (10 ms)
    TIMEOUT Clarification
      ‚úì should state that TIMEOUT is unknown state, not failure (3 ms)
    classifyFailure
      ‚úì should classify validation error as VALIDATION_FAILURE (46 ms)
      ‚úì should classify timeout as TIMEOUT (34 ms)
      ‚úì should classify connection refused as TRANSPORT_ERROR (56 ms)
      ‚úì should classify HTTP 401 as AUTHZ_FAILURE (15 ms)
      ‚úì should sanitize error messages (3 ms)
    isRetryable
      ‚úì should return true for TRANSPORT_ERROR (41 ms)
      ‚úì should return true for SYSTEM_FAILURE (4 ms)
      ‚úì should return false for TIMEOUT (3 ms)
      ‚úì should return false for RAIL_REJECT (14 ms)
    requiresRepair
      ‚úì should return true for TIMEOUT (2 ms)
      ‚úì should return false for TRANSPORT_ERROR (1 ms)

{"level":30,"time":1768711330310,"system":"symphony","requestId":"req-001","failureClass":"TIMEOUT","retryAllowed":false,"repairRequired":true,"msg":"Failure classified"}
{"level":30,"time":1768711330407,"system":"symphony","requestId":"req-001","failureClass":"TRANSPORT_ERROR","retryAllowed":true,"repairRequired":false,"msg":"Failure classified"}
{"level":30,"time":1768711330411,"system":"symphony","requestId":"req-001","failureClass":"AUTHZ_FAILURE","retryAllowed":false,"repairRequired":false,"msg":"Failure classified"}
{"level":30,"time":1768711330427,"system":"symphony","requestId":"req-001","failureClass":"SYSTEM_FAILURE","retryAllowed":true,"repairRequired":false,"msg":"Failure classified"}
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
PASS tests/retry-eligibility.test.ts
  Phase 7.2: Retry Eligibility
    Retry Semantics
      ‚úì retry should use same instruction, not create new one (50 ms)
    Failure Class Retry Eligibility
      ‚úì VALIDATION_FAILURE should block retry (2 ms)
      ‚úì TIMEOUT should redirect to repair (2 ms)
      ‚úì TRANSPORT_ERROR should allow retry (36 ms)
    Invariant INV-PERSIST-03
      ‚úì retry must preserve idempotency key (1 ms)

ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
{"level":60,"time":1768711333984,"system":"symphony","errors":["FATAL CONFIG: Required env var DB_HOST is missing","FATAL CONFIG: Required env var DB_PORT is missing","FATAL CONFIG: Required env var DB_USER is missing","FATAL CONFIG: Required env var DB_PASSWORD is missing","FATAL CONFIG: Required env var DB_NAME is missing"],"remediation":"Check environment variables. No defaults allowed.","msg":"Configuration Guard Violation"}
  ‚óè  process.exit called with "1"

      67 |
      68 |             // Immediate fatal exit
    > 69 |             process.exit(1);
         |                     ^
      70 |         }
      71 |
      72 |         logger.info("Configuration guard passed.");

      at Function.enforce (libs/bootstrap/config-guard.ts:69:21)
      at libs/db/index.ts:10:13
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
ts-jest[config] (WARN) [94mmessage[0m[90m TS151002: [0mUsing hybrid module kind (Node16/18/Next) is only supported in "isolatedModules: true". Please set "isolatedModules: true" in your tsconfig.json. To disable this message, you can set "diagnostics.ignoreCodes" to include 151002 in your ts-jest config. See more at https://kulshekhar.github.io/ts-jest/docs/getting-started/options/diagnostics
{"level":60,"time":1768711335032,"system":"symphony","errors":["FATAL CONFIG: Required env var DB_HOST is missing","FATAL CONFIG: Required env var DB_PORT is missing","FATAL CONFIG: Required env var DB_USER is missing","FATAL CONFIG: Required env var DB_PASSWORD is missing","FATAL CONFIG: Required env var DB_NAME is missing"],"remediation":"Check environment variables. No defaults allowed.","msg":"Configuration Guard Violation"}
  ‚óè  process.exit called with "1"

      67 |
      68 |             // Immediate fatal exit
    > 69 |             process.exit(1);
         |                     ^
      70 |         }
      71 |
      72 |         logger.info("Configuration guard passed.");

      at Function.enforce (libs/bootstrap/config-guard.ts:69:21)
      at libs/db/index.ts:10:13
{"level":60,"time":1768711350816,"system":"symphony","errors":["FATAL CONFIG: Required env var DB_HOST is missing","FATAL CONFIG: Required env var DB_PORT is missing","FATAL CONFIG: Required env var DB_USER is missing","FATAL CONFIG: Required env var DB_PASSWORD is missing","FATAL CONFIG: Required env var DB_NAME is missing"],"remediation":"Check environment variables. No defaults allowed.","msg":"Configuration Guard Violation"}
  ‚óè  process.exit called with "1"

      67 |
      68 |             // Immediate fatal exit
    > 69 |             process.exit(1);
         |                     ^
      70 |         }
      71 |
      72 |         logger.info("Configuration guard passed.");

      at Function.enforce (libs/bootstrap/config-guard.ts:69:21)
      at libs/db/index.ts:10:13
{"level":60,"time":1768711351129,"system":"symphony","errors":["FATAL CONFIG: Required env var DB_HOST is missing","FATAL CONFIG: Required env var DB_PORT is missing","FATAL CONFIG: Required env var DB_USER is missing","FATAL CONFIG: Required env var DB_PASSWORD is missing","FATAL CONFIG: Required env var DB_NAME is missing"],"remediation":"Check environment variables. No defaults allowed.","msg":"Configuration Guard Violation"}
  ‚óè  process.exit called with "1"

      67 |
      68 |             // Immediate fatal exit
    > 69 |             process.exit(1);
         |                     ^
      70 |         }
      71 |
      72 |         logger.info("Configuration guard passed.");

      at Function.enforce (libs/bootstrap/config-guard.ts:69:21)
      at libs/db/index.ts:10:13
{"level":60,"time":1768711363239,"system":"symphony","errors":["FATAL CONFIG: Required env var DB_HOST is missing","FATAL CONFIG: Required env var DB_PORT is missing","FATAL CONFIG: Required env var DB_USER is missing","FATAL CONFIG: Required env var DB_PASSWORD is missing","FATAL CONFIG: Required env var DB_NAME is missing"],"remediation":"Check environment variables. No defaults allowed.","msg":"Configuration Guard Violation"}
{"level":60,"time":1768711363249,"system":"symphony","errors":["FATAL CONFIG: Required env var DB_HOST is missing","FATAL CONFIG: Required env var DB_PORT is missing","FATAL CONFIG: Required env var DB_USER is missing","FATAL CONFIG: Required env var DB_PASSWORD is missing","FATAL CONFIG: Required env var DB_NAME is missing"],"remediation":"Check environment variables. No defaults allowed.","msg":"Configuration Guard Violation"}
  ‚óè  process.exit called with "1"

      67 |
      68 |             // Immediate fatal exit
    > 69 |             process.exit(1);
         |                     ^
      70 |         }
      71 |
      72 |         logger.info("Configuration guard passed.");

      at Function.enforce (libs/bootstrap/config-guard.ts:69:21)
      at libs/db/index.ts:10:13
  ‚óè  process.exit called with "1"

      67 |
      68 |             // Immediate fatal exit
    > 69 |             process.exit(1);
         |                     ^
      70 |         }
      71 |
      72 |         logger.info("Configuration guard passed.");

      at Function.enforce (libs/bootstrap/config-guard.ts:69:21)
      at libs/db/index.ts:10:13
{"level":60,"time":1768711372728,"system":"symphony","errors":["FATAL CONFIG: Required env var DB_HOST is missing","FATAL CONFIG: Required env var DB_PORT is missing","FATAL CONFIG: Required env var DB_USER is missing","FATAL CONFIG: Required env var DB_PASSWORD is missing","FATAL CONFIG: Required env var DB_NAME is missing"],"remediation":"Check environment variables. No defaults allowed.","msg":"Configuration Guard Violation"}
  ‚óè  process.exit called with "1"

      67 |
      68 |             // Immediate fatal exit
    > 69 |             process.exit(1);
         |                     ^
      70 |         }
      71 |
      72 |         logger.info("Configuration guard passed.");

      at Function.enforce (libs/bootstrap/config-guard.ts:69:21)
      at libs/db/index.ts:10:13
FAIL tests/runtime-guards.test.ts
  ‚óè Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/index.js:805:21)

{"level":60,"time":1768711372886,"system":"symphony","errors":["FATAL CONFIG: Required env var DB_HOST is missing","FATAL CONFIG: Required env var DB_PORT is missing","FATAL CONFIG: Required env var DB_USER is missing","FATAL CONFIG: Required env var DB_PASSWORD is missing","FATAL CONFIG: Required env var DB_NAME is missing"],"remediation":"Check environment variables. No defaults allowed.","msg":"Configuration Guard Violation"}
  ‚óè  process.exit called with "1"

      67 |
      68 |             // Immediate fatal exit
    > 69 |             process.exit(1);
         |                     ^
      70 |         }
      71 |
      72 |         logger.info("Configuration guard passed.");

      at Function.enforce (libs/bootstrap/config-guard.ts:69:21)
      at libs/db/index.ts:10:13
FAIL tests/participant-identity.test.ts
  ‚óè Test suite failed to run

    Jest worker encountered 4 child process exceptions, exceeding retry limit

      at ChildProcessWorker.initialize (node_modules/jest-worker/build/index.js:805:21)

Test Suites: 2 failed, 3 passed, 5 total
Tests:       31 passed, 31 total
Snapshots:   0 total
Time:        78.781 s
Ran all test suites.
