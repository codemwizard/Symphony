### Chat Summary

#### Objectives
- Implement the Phase‑0 SQLSTATE plan in‑repo: add contract files, SQLSTATE registry, drift checks, and wire evidence enforcement into CI.
- Ensure CI evidence gate is reliable and avoids phantom failures while remaining fail‑closed for completed tasks.

#### Key Actions & Discussions
- **Task creation and refinement**:
  - Drafted four new Phase‑0 tasks (TSK‑P0‑037..040) to implement a Phase‑0 evidence contract, SQLSTATE registry + drift check, manifest registration, and CI wiring.
  - User requested stricter governance: avoid invariant ID collisions, enforce explicit contract fields, normalize CI artifact paths, ensure evidence is written even on failure, and limit drift scan scope.
- **Contract‑based evidence enforcement**:
  - Implemented a Phase‑0 contract (`docs/PHASE0/phase0_contract.yml`) as the source of truth for evidence enforcement.
  - Updated the evidence gate to enforce only `status=completed` and `evidence_required=true` tasks, and to accept CI artifact path layouts.
- **SQLSTATE registry and drift checking**:
  - Added a SQLSTATE registry (`docs/contracts/sqlstate_map.yml`) with required fields and canonical/alias handling.
  - Implemented `check_sqlstate_map_drift.sh` to scan migrations/scripts/docs for `Pxxxx` codes with explicit exclusions, and emit evidence on failure.
- **Invariant registration**:
  - Added new invariants to the manifest (INV‑060: contract governs evidence gate, INV‑061: SQLSTATE registry drift‑free), updated implemented docs, and regenerated QUICK.
- **CI wiring**:
  - Wired the new contract and SQLSTATE checks into the fast‑checks job in `invariants.yml`.
  - Ensured evidence artifacts are uploaded and evidence gate uses merged artifacts.
- **Exception handling**:
  - A failed exception template check was resolved by closing the exception with `closed_at` (since required docs were updated).
- **Validation**:
  - Fast checks passed after updates.
  - Contract‑based evidence check passed in CI‑only mode.
  - Scan confirmed no completed tasks were missing required evidence; only TSK‑P0‑010 uses a glob as expected.

#### Decisions Made
- **Invariant IDs**: Reserve a new range to avoid conflicts (INV‑060, INV‑061).
- **Contract schema**: Require explicit fields, avoid broad globs, and treat the contract as the enforcement authority for evidence.
- **Evidence enforcement behavior**: Normalize CI artifact paths and accept nested layouts; write evidence even on failure.
- **Drift check scope**: Scan only migrations/scripts/docs and exclude generated/noisy files.
- **Exception closure**: Close exceptions via `closed_at` when docs are updated, rather than extending expiry.

#### Insights & Reasoning
- The evidence gate failure pattern was primarily due to mismatched roots or artifact layout assumptions; a contract‑driven gate with path normalization prevents phantom failures.
- Evidence checks must be deterministic and produce evidence even on failure to avoid masking real issues.
- SQLSTATE drift checks need scoped scanning to be strict without false positives, ensuring audit‑grade traceability.

#### Next Steps
- Optionally replace the TSK‑P0‑010 glob with explicit evidence paths if stricter enforcement is desired.
- Run CI to confirm the contract‑based evidence gate and new SQLSTATE drift checks are green in Actions.
