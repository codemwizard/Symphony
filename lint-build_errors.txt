mwiza@DESKTOP-VV0116A:~/workspaces/Symphony$ npm run lint

> symphony@1.0.0 lint
> eslint

mwiza@DESKTOP-VV0116A:~/workspaces/Symphony$ npm run build

> symphony@1.0.0 build
> tsc --noEmit

libs/audit/guardLogger.ts:75:13 - error TS2783: 'requestId' is specified more than once, so this usage will be overwritten.

75             requestId: event.requestId,
               ~~~~~~~~~~~~~~~~~~~~~~~~~~

  libs/audit/guardLogger.ts:78:13
    78             ...event
                   ~~~~~~~~
    This spread always overwrites this property.

libs/audit/guardLogger.ts:76:13 - error TS2783: 'ingressSequenceId' is specified more than once, so this usage will be overwritten.

76             ingressSequenceId: event.ingressSequenceId,
               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  libs/audit/guardLogger.ts:78:13
    78             ...event
                   ~~~~~~~~
    This spread always overwrites this property.

libs/audit/integrity.ts:23:39 - error TS2345: Argument of type 'string | undefined' is not assignable to parameter of type 'string'.
  Type 'undefined' is not assignable to type 'string'.

23             const record = JSON.parse(lines[i]) as AuditRecordV1;
                                         ~~~~~~~~

libs/audit/logger.ts:63:17 - error TS2322: Type '"client" | "service" | "user"' is not assignable to type '"client" | "service"'.
  Type '"user"' is not assignable to type '"client" | "service"'.

63                 type: context.subjectType,
                   ~~~~

libs/bootstrap/config-guard.ts:16:60 - error TS2322: Type 'boolean | undefined' is not assignable to type 'boolean'.
  Type 'undefined' is not assignable to type 'boolean'.

16     { type: 'forbidIf', name: 'DEV_KMS_CHECK', when: () => process.env['NODE_ENV'] === 'production' && process.env['KMS_ENDPOINT']?.includes('localhost'), message: 'Production cannot use localhost KMS' },
                                                              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  libs/bootstrap/config-guard.ts:5:47
    5     | { type: 'forbidIf'; name: string; when: () => boolean; message: string }
                                                    ~~~~~~~~~~~~~
    The expected type comes from the return type of this signature.

libs/bridge/jwtToMtlsBridge.ts:69:15 - error TS2375: Type '{ version: "v1"; requestId: `${string}-${string}-${string}-${string}-${string}`; issuedAt: string; issuerService: string; subjectType: "client"; subjectId: string; tenantId: string; policyVersion: string; roles: string[]; trustTier: "external"; signature: string; certFingerprint: string | undefined; }' is not assignable to type 'IdentityEnvelopeV1' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the types of the target's properties.
  Types of property 'certFingerprint' are incompatible.
    Type 'string | undefined' is not assignable to type 'string'.
      Type 'undefined' is not assignable to type 'string'.

69         const context: IdentityEnvelopeV1 = {
                 ~~~~~~~

libs/context/requestContext.ts:2:42 - error TS2835: Relative import paths need explicit file extensions in ECMAScript imports when '--moduleResolution' is 'node16' or 'nodenext'. Did you mean './identity.js'?

2 import { ValidatedIdentityContext } from "./identity";
                                           ~~~~~~~~~~~~

libs/context/verifyIdentity.ts:87:50 - error TS18048: 'allowed' is possibly 'undefined'.

87         if (envelope.subjectType === 'client' && allowed.includes('client')) {
                                                    ~~~~~~~

libs/context/verifyIdentity.ts:123:5 - error TS2375: Type 'Readonly<{ certFingerprint: string | undefined; version: "v1"; requestId: string; issuedAt: string; issuerService: string; subjectType: "client" | "service" | "user"; subjectId: string; tenantId: string; ... 6 more ...; participantStatus?: ParticipantStatus; }>' is not assignable to type 'Readonly<IdentityEnvelopeV1>' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the types of the target's properties.
  Types of property 'certFingerprint' are incompatible.
    Type 'string | undefined' is not assignable to type 'string'.
      Type 'undefined' is not assignable to type 'string'.

123     return Object.freeze({ ...envelope, certFingerprint });
        ~~~~~~

libs/crypto/keyManager.ts:26:37 - error TS2345: Argument of type '[{ region: string | undefined; endpoint: string | undefined; credentials: { accessKeyId: string; secretAccessKey: string; }; }]' is not assignable to parameter of type '[] | [KMSClientConfig]'.
  Type '[{ region: string | undefined; endpoint: string | undefined; credentials: { accessKeyId: string; secretAccessKey: string; }; }]' is not assignable to type '[KMSClientConfig]'.
    Type '{ region: string | undefined; endpoint: string | undefined; credentials: { accessKeyId: string; secretAccessKey: string; }; }' is not assignable to type 'KMSClientConfig' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the types of the target's properties.
      Type '{ region: string | undefined; endpoint: string | undefined; credentials: { accessKeyId: string; secretAccessKey: string; }; }' is not assignable to type 'ClientDefaults' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the types of the target's properties.
        Types of property 'region' are incompatible.
          Type 'string | undefined' is not assignable to type 'string | Provider<string>'.
            Type 'undefined' is not assignable to type 'string | Provider<string>'.

 26         this.client = new KMSClient({
                                        ~
 27             region: process.env.KMS_REGION,
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
...
 32             }
    ~~~~~~~~~~~~~
 33         });
    ~~~~~~~~~

libs/execution/attemptRepository.ts:233:5 - error TS2375: Type 'Readonly<{ attemptId: string; instructionId: string; sequenceNumber: number; state: AttemptState; railResponse: RailResponse | undefined; failureClass: string | undefined; createdAt: string; resolvedAt: string | undefined; ingressSequenceId: string; requestId: string; }>' is not assignable to type 'ExecutionAttempt' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the types of the target's properties.
  Types of property 'railResponse' are incompatible.
    Type 'RailResponse | undefined' is not assignable to type 'RailResponse'.
      Type 'undefined' is not assignable to type 'RailResponse'.

233     return Object.freeze({
        ~~~~~~

libs/execution/failureClassifier.ts:146:11 - error TS2375: Type '{ failureClass: FailureClass; eligibility: RetryEligibility; errorCode: string | undefined; errorMessage: string | undefined; classifiedAt: string; }' is not assignable to type 'FailureClassification' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the types of the target's properties.
  Types of property 'errorCode' are incompatible.
    Type 'string | undefined' is not assignable to type 'string'.
      Type 'undefined' is not assignable to type 'string'.

146     const classification: FailureClassification = {
              ~~~~~~~~~~~~~~

libs/execution/instructionStateClient.ts:106:11 - error TS2375: Type '{ instructionId: string; targetState: "FAILED" | "COMPLETED"; reason: string | undefined; }' is not assignable to type 'TransitionRequest' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the types of the target's properties.
  Types of property 'reason' are incompatible.
    Type 'string | undefined' is not assignable to type 'string'.
      Type 'undefined' is not assignable to type 'string'.

106     const request: TransitionRequest = {
              ~~~~~~~

libs/execution/repairWorkflow.ts:94:11 - error TS2375: Type '{ repairEventId: `${string}-${string}-${string}-${string}-${string}`; instructionId: string; attemptId: string; railId: string; reconciliationResult: ReconciliationResult; recommendedTransition: "FAILED" | ... 1 more ... | undefined; createdAt: string; requestId: string; }' is not assignable to type 'RepairEvent' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the types of the target's properties.
  Types of property 'recommendedTransition' are incompatible.
    Type '"FAILED" | "COMPLETED" | undefined' is not assignable to type '"FAILED" | "COMPLETED"'.
      Type 'undefined' is not assignable to type '"FAILED" | "COMPLETED"'.

94     const repairEvent: RepairEvent = {
             ~~~~~~~~~~~

libs/execution/repairWorkflow.ts:117:11 - error TS2375: Type '{ resolved: boolean; reconciliationResult: ReconciliationResult; recommendedTransition: "FAILED" | "COMPLETED" | undefined; repairedAt: string; repairEventId: `${string}-${string}-${string}-${string}-${string}`; }' is not assignable to type 'RepairOutcome' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the types of the target's properties.
  Types of property 'recommendedTransition' are incompatible.
    Type '"FAILED" | "COMPLETED" | undefined' is not assignable to type '"FAILED" | "COMPLETED"'.
      Type 'undefined' is not assignable to type '"FAILED" | "COMPLETED"'.

117     const outcome: RepairOutcome = {
              ~~~~~~~

libs/guards/policyGuard.ts:121:5 - error TS2375: Type '{ maxTransactionAmount: string | undefined; maxTransactionsPerSecond: number | undefined; dailyAggregateLimit: string | undefined; allowedMessageTypes: readonly string[] | undefined; }' is not assignable to type 'SandboxLimits' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the types of the target's properties.
  Types of property 'maxTransactionAmount' are incompatible.
    Type 'string | undefined' is not assignable to type 'string'.
      Type 'undefined' is not assignable to type 'string'.

121     return {
        ~~~~~~

libs/incident/containment.ts:1:65 - error TS2835: Relative import paths need explicit file extensions in ECMAScript imports when '--moduleResolution' is 'node16' or 'nodenext'. Did you mean './taxonomy.js'?

1 import { IncidentSignal, IncidentClass, IncidentSeverity } from "./taxonomy";
                                                                  ~~~~~~~~~~~~

libs/incident/containment.ts:2:24 - error TS2835: Relative import paths need explicit file extensions in ECMAScript imports when '--moduleResolution' is 'node16' or 'nodenext'. Did you mean '../logging/logger.js'?

2 import { logger } from "../logging/logger";
                         ~~~~~~~~~~~~~~~~~~~

libs/incident/containment.ts:3:29 - error TS2835: Relative import paths need explicit file extensions in ECMAScript imports when '--moduleResolution' is 'node16' or 'nodenext'. Did you mean '../audit/logger.js'?

3 import { auditLogger } from "../audit/logger";
                              ~~~~~~~~~~~~~~~~~

libs/incident/detector.ts:1:77 - error TS2835: Relative import paths need explicit file extensions in ECMAScript imports when '--moduleResolution' is 'node16' or 'nodenext'. Did you mean './taxonomy.js'?

1 import { IncidentSignal, IncidentClass, IncidentSeverity, isMaterial } from "./taxonomy";
                                                                              ~~~~~~~~~~~~

libs/incident/detector.ts:2:24 - error TS2835: Relative import paths need explicit file extensions in ECMAScript imports when '--moduleResolution' is 'node16' or 'nodenext'. Did you mean '../logging/logger.js'?

2 import { logger } from "../logging/logger";
                         ~~~~~~~~~~~~~~~~~~~

libs/incident/detector.ts:3:29 - error TS2835: Relative import paths need explicit file extensions in ECMAScript imports when '--moduleResolution' is 'node16' or 'nodenext'. Did you mean '../audit/logger.js'?

3 import { auditLogger } from "../audit/logger";
                              ~~~~~~~~~~~~~~~~~

libs/incident/detector.ts:4:37 - error TS2835: Relative import paths need explicit file extensions in ECMAScript imports when '--moduleResolution' is 'node16' or 'nodenext'. Did you mean './containment.js'?

4 import { IncidentContainment } from "./containment";
                                      ~~~~~~~~~~~~~~~

libs/logging/logger.ts:2:42 - error TS2835: Relative import paths need explicit file extensions in ECMAScript imports when '--moduleResolution' is 'node16' or 'nodenext'. Did you mean '../context/identity.js'?

2 import { ValidatedIdentityContext } from "../context/identity";
                                           ~~~~~~~~~~~~~~~~~~~~~

libs/policy/PolicyConsistencyMiddleware.ts:466:13 - error TS2412: Type 'PolicyScope | undefined' is not assignable to type 'PolicyScope' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the type of the target.
  Type 'undefined' is not assignable to type 'PolicyScope'.

466             (req as { policyScope?: PolicyScope }).policyScope =
                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

scripts/ops/capture_incident_evidence.ts:2:65 - error TS2835: Relative import paths need explicit file extensions in ECMAScript imports when '--moduleResolution' is 'node16' or 'nodenext'. Did you mean '../../libs/incident/taxonomy.js'?

2 import { IncidentSignal, IncidentClass, IncidentSeverity } from "../../libs/incident/taxonomy";
                                                                  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

scripts/ops/export_evidence.ts:29:33 - error TS2345: Argument of type 'string | undefined' is not assignable to parameter of type 'string'.
  Type 'undefined' is not assignable to type 'string'.

29     const lastLine = JSON.parse(lines[recordCount - 1]);
                                   ~~~~~~~~~~~~~~~~~~~~~~

scripts/ops/restore_from_backup.ts:36:9 - error TS2741: Property 'trustTier' is missing in type '{ version: "v1"; issuedAt: string; issuerService: string; requestId: string; subjectId: string; subjectType: "service"; tenantId: string; policyVersion: string; roles: string[]; signature: string; }' but required in type 'Readonly<IdentityEnvelopeV1>'.

36         context: {
           ~~~~~~~

  libs/context/identity.ts:22:5
    22     trustTier: 'external' | 'internal';
           ~~~~~~~~~
    'trustTier' is declared here.
  libs/audit/logger.ts:46:13
    46             context: ValidatedIdentityContext;
                   ~~~~~~~
    The expected type comes from property 'context' which is declared here on type '{ type: AuditEventType; context: Readonly<IdentityEnvelopeV1>; action?: { capability?: string; resource?: string; }; decision: "ALLOW" | "DENY" | "EXECUTED"; reason?: string; }'

scripts/validation/invariant-scanner.ts:21:47 - error TS2339: Property 'validateGlobalInvariant' does not exist on type 'typeof ProofOfFunds'.

21             const passed = await ProofOfFunds.validateGlobalInvariant(currency);
                                                 ~~~~~~~~~~~~~~~~~~~~~~~

scripts/verification/ledger_replay.ts:116:63 - error TS2345: Argument of type 'PoolClient' is not assignable to parameter of type 'never'.

116             const attestations = await this.fetchAttestations(client, config);
                                                                  ~~~~~~

scripts/verification/ledger_replay.ts:117:51 - error TS2345: Argument of type 'PoolClient' is not assignable to parameter of type 'never'.

117             const outbox = await this.fetchOutbox(client, config);
                                                      ~~~~~~

scripts/verification/ledger_replay.ts:118:51 - error TS2345: Argument of type 'PoolClient' is not assignable to parameter of type 'never'.

118             const ledger = await this.fetchLedger(client, config);
                                                      ~~~~~~

scripts/verification/ledger_replay.ts:185:37 - error TS2339: Property 'query' does not exist on type 'never'.

185         const result = await client.query(query, params);
                                        ~~~~~

scripts/verification/ledger_replay.ts:211:37 - error TS2339: Property 'query' does not exist on type 'never'.

211         const result = await client.query(query, params);
                                        ~~~~~

scripts/verification/ledger_replay.ts:241:37 - error TS2339: Property 'query' does not exist on type 'never'.

241         const result = await client.query(query, params);
                                        ~~~~~

scripts/verification/ledger_replay.ts:280:17 - error TS2322: Type 'string | undefined' is not assignable to type 'string'.
  Type 'undefined' is not assignable to type 'string'.

280                 accountId,
                    ~~~~~~~~~

  scripts/verification/ledger_replay.ts:64:14
    64     readonly accountId: string;
                    ~~~~~~~~~
    The expected type comes from property 'accountId' which is declared here on type 'ReconstructedBalance'

services/read-api/src/index.ts:37:44 - error TS2345: Argument of type '(_query: unknown) => Promise<void>' is not assignable to parameter of type '() => void | Promise<void>'.
  Target signature provides too few arguments. Expected 1 or more, but got 0.

37         return RequestContext.run(context, async (_query: unknown) => {
                                              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/repair-workflow.test.ts:13:58 - error TS2345: Argument of type 'undefined' is not assignable to parameter of type 'never'.

13     guardAuditLogger: { log: jest.fn().mockResolvedValue(undefined) }
                                                            ~~~~~~~~~

tests/repair-workflow.test.ts:26:46 - error TS2345: Argument of type '{ rows: never[]; }' is not assignable to parameter of type 'never'.

26     db: { query: jest.fn().mockResolvedValue({ rows: [] }) }
                                                ~~~~~~~~~~~~

tests/retry-eligibility.test.ts:11:58 - error TS2345: Argument of type 'undefined' is not assignable to parameter of type 'never'.

11     guardAuditLogger: { log: jest.fn().mockResolvedValue(undefined) }
                                                            ~~~~~~~~~

tests/runtime-guards.test.ts:35:42 - error TS2345: Argument of type 'undefined' is not assignable to parameter of type 'never'.

35         log: jest.fn().mockResolvedValue(undefined)
                                            ~~~~~~~~~

tests/unit/AuditIntegrity.spec.ts:53:33 - error TS2345: Argument of type 'string | undefined' is not assignable to parameter of type 'string'.
  Type 'undefined' is not assignable to type 'string'.

53         const rec1 = JSON.parse(lines[1]);
                                   ~~~~~~~~

tests/unit/Authorize.spec.ts:77:32 - error TS2367: This comparison appears to be unintentional because the types '"v0.9.0"' and '"v1.0.0"' have no overlap.

77             const isMismatch = contextVersion !== activePolicyVersion;
                                  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/EvidenceExportService.spec.ts:46:45 - error TS2345: Argument of type '{ connect: Mock<Function>; }' is not assignable to parameter of type 'Pool'.
  Type '{ connect: Mock<Function>; }' is missing the following properties from type 'Pool': totalCount, idleCount, waitingCount, expiredCount, and 20 more.

46         service = new EvidenceExportService(mockPool, MOCK_CONFIG, mockFs);
                                               ~~~~~~~~

tests/unit/EvidenceExportService.spec.ts:66:26 - error TS2532: Object is possibly 'undefined'.

66             assert.match(mockQuery.mock.calls[0].arguments[0], /MAX\(id\)/);
                            ~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/EvidenceExportService.spec.ts:66:26 - error TS2345: Argument of type 'unknown' is not assignable to parameter of type 'string'.

66             assert.match(mockQuery.mock.calls[0].arguments[0], /MAX\(id\)/);
                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/EvidenceExportService.spec.ts:134:36 - error TS2532: Object is possibly 'undefined'.

134             const firstWriteArgs = mockFs.writeFile.mock.calls[0].arguments;
                                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/EvidenceExportService.spec.ts:135:23 - error TS2571: Object is of type 'unknown'.

135             assert.ok(firstWriteArgs[0].includes(result.batchId + '.json'));
                          ~~~~~~~~~~~~~~~~~

tests/unit/IngressAttestationMiddleware.spec.ts:32:13 - error TS2353: Object literal may only specify known properties, and 'query' does not exist in type '{ connect: Mock<Function>; }'.

32             query: mock.fn() // method not used by service directly, but good to have
               ~~~~~

tests/unit/IngressAttestationMiddleware.spec.ts:34:49 - error TS2345: Argument of type '{ connect: Mock<Function>; }' is not assignable to parameter of type 'Pool'.
  Type '{ connect: Mock<Function>; }' is missing the following properties from type 'Pool': totalCount, idleCount, waitingCount, expiredCount, and 20 more.

34         service = new IngressAttestationService(mockPool);
                                                   ~~~~~~~~

tests/unit/JwtBridge.spec.ts:7:15 - error TS2305: Module '"jose"' has no exported member 'KeyLike'.

7 import type { KeyLike } from 'jose';
                ~~~~~~~

tests/unit/OutboxDispatchService.spec.ts:28:13 - error TS2353: Object literal may only specify known properties, and 'query' does not exist in type '{ connect: Mock<Function>; }'.

28             query: mock.fn(async () => ({ rows: [] }))
               ~~~~~

tests/unit/OutboxDispatchService.spec.ts:35:45 - error TS2345: Argument of type '{ connect: Mock<Function>; }' is not assignable to parameter of type 'Pool'.
  Type '{ connect: Mock<Function>; }' is missing the following properties from type 'Pool': totalCount, idleCount, waitingCount, expiredCount, and 20 more.

35         service = new OutboxDispatchService(mockPool, mockIdGenerator);
                                               ~~~~~~~~

tests/unit/OutboxDispatchService.spec.ts:78:26 - error TS2345: Argument of type 'unknown' is not assignable to parameter of type 'string'.

78             assert.match(queries[queries.length - 1], /COMMIT/);
                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/OutboxDispatchService.spec.ts:101:32 - error TS18048: 'lastCall' is possibly 'undefined'.

101             assert.strictEqual(lastCall.arguments[0], 'ROLLBACK');
                                   ~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:39:37 - error TS2345: Argument of type '{ connect: Mock<Function>; query: Mock<Function>; }' is not assignable to parameter of type 'Pool'.
  Type '{ connect: Mock<Function>; query: Mock<Function>; }' is missing the following properties from type 'Pool': totalCount, idleCount, waitingCount, expiredCount, and 19 more.

39         relayer = new OutboxRelayer(mockPool, mockRailClient);
                                       ~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:73:23 - error TS18048: 'queryCall' is possibly 'undefined'.

73             assert.ok(queryCall.arguments[0].includes('FOR UPDATE SKIP LOCKED'), 'Should use SKIP LOCKED');
                         ~~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:73:23 - error TS2571: Object is of type 'unknown'.

73             assert.ok(queryCall.arguments[0].includes('FOR UPDATE SKIP LOCKED'), 'Should use SKIP LOCKED');
                         ~~~~~~~~~~~~~~~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:95:34 - error TS2532: Object is possibly 'undefined'.

95             const dispatchArgs = mockRailClient.dispatch.mock.calls[0].arguments[0];
                                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:96:32 - error TS18046: 'dispatchArgs' is of type 'unknown'.

96             assert.strictEqual(dispatchArgs.reference, 'uuid-1');
                                  ~~~~~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:100:23 - error TS2532: Object is possibly 'undefined'.

100             assert.ok(mockPool.query.mock.calls[0].arguments[0].includes("status = 'SUCCESS'"));
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:100:23 - error TS2571: Object is of type 'unknown'.

100             assert.ok(mockPool.query.mock.calls[0].arguments[0].includes("status = 'SUCCESS'"));
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:123:27 - error TS2532: Object is possibly 'undefined'.

123             const query = mockPool.query.mock.calls[0].arguments[0];
                              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:124:28 - error TS2532: Object is possibly 'undefined'.

124             const params = mockPool.query.mock.calls[0].arguments[1];
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:126:23 - error TS18046: 'query' is of type 'unknown'.

126             assert.ok(query.includes("status = $1")); // Parameterized update
                          ~~~~~

tests/unit/OutboxRelayer.spec.ts:127:32 - error TS18046: 'params' is of type 'unknown'.

127             assert.strictEqual(params[0], 'RECOVERING');
                                   ~~~~~~

tests/unit/OutboxRelayer.spec.ts:150:28 - error TS2532: Object is possibly 'undefined'.

150             const params = mockPool.query.mock.calls[0].arguments[1];
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:152:27 - error TS2532: Object is possibly 'undefined'.

152             const query = mockPool.query.mock.calls[0].arguments[0];
                              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~

tests/unit/OutboxRelayer.spec.ts:153:23 - error TS18046: 'query' is of type 'unknown'.

153             assert.ok(query.includes("status = 'FAILED'"));
                          ~~~~~

tests/unit/OutboxRelayer.spec.ts:154:23 - error TS18046: 'params' is of type 'unknown'.

154             assert.ok(params[1].includes('DLQ:'));
                          ~~~~~~

tests/unit/PolicyConsistencyMiddleware.spec.ts:63:48 - error TS2345: Argument of type '{ query: Mock<Function>; }' is not assignable to parameter of type 'Pool'.
  Type '{ query: Mock<Function>; }' is missing the following properties from type 'Pool': totalCount, idleCount, waitingCount, expiredCount, and 20 more.

63         service = new PolicyConsistencyService(mockPool);
                                                  ~~~~~~~~

tests/unit/ShortLivedCertificateManager.spec.ts:63:19 - error TS2375: Type '{ fingerprint: string; revoked: false; revokedAt: undefined; revokedReason: undefined; }' is not assignable to type 'TestCertificate' with 'exactOptionalPropertyTypes: true'. Consider adding 'undefined' to the types of the target's properties.
  Types of property 'revokedAt' are incompatible.
    Type 'undefined' is not assignable to type 'Date'.

63             const cert: TestCertificate = {
                     ~~~~

tests/unit/ShortLivedCertificateManager.spec.ts:109:32 - error TS2532: Object is possibly 'undefined'.

109             assert.strictEqual(certificates[0].revoked, true);
                                   ~~~~~~~~~~~~~~~

tests/unit/ShortLivedCertificateManager.spec.ts:110:32 - error TS2532: Object is possibly 'undefined'.

110             assert.strictEqual(certificates[1].revoked, true);
                                   ~~~~~~~~~~~~~~~

tests/unit/ShortLivedCertificateManager.spec.ts:111:32 - error TS2532: Object is possibly 'undefined'.

111             assert.strictEqual(certificates[2].revoked, false); // Different participant
                                   ~~~~~~~~~~~~~~~

tests/unit/ZombieRepairWorker.spec.ts:33:41 - error TS2345: Argument of type '{ connect: Mock<Function>; query: Mock<Function>; }' is not assignable to parameter of type 'Pool'.
  Type '{ connect: Mock<Function>; query: Mock<Function>; }' is missing the following properties from type 'Pool': totalCount, idleCount, waitingCount, expiredCount, and 19 more.

33         worker = new ZombieRepairWorker(mockPool);
                                           ~~~~~~~~

tests/unit/ZombieRepairWorker.spec.ts:61:34 - error TS2532: Object is possibly 'undefined'.

61             const lastCallArgs = mockClient.query.mock.calls[mockClient.query.mock.calls.length - 1].arguments;
                                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


Found 77 errors in 36 files.

Errors  Files
     2  libs/audit/guardLogger.ts:75
     1  libs/audit/integrity.ts:23
     1  libs/audit/logger.ts:63
     1  libs/bootstrap/config-guard.ts:16
     1  libs/bridge/jwtToMtlsBridge.ts:69
     1  libs/context/requestContext.ts:2
     2  libs/context/verifyIdentity.ts:87
     1  libs/crypto/keyManager.ts:26
     1  libs/execution/attemptRepository.ts:233
     1  libs/execution/failureClassifier.ts:146
     1  libs/execution/instructionStateClient.ts:106
     2  libs/execution/repairWorkflow.ts:94
     1  libs/guards/policyGuard.ts:121
     3  libs/incident/containment.ts:1
     4  libs/incident/detector.ts:1
     1  libs/logging/logger.ts:2
     1  libs/policy/PolicyConsistencyMiddleware.ts:466
     1  scripts/ops/capture_incident_evidence.ts:2
     1  scripts/ops/export_evidence.ts:29
     1  scripts/ops/restore_from_backup.ts:36
     1  scripts/validation/invariant-scanner.ts:21
     7  scripts/verification/ledger_replay.ts:116
     1  services/read-api/src/index.ts:37
     2  tests/repair-workflow.test.ts:13
     1  tests/retry-eligibility.test.ts:11
     1  tests/runtime-guards.test.ts:35
     1  tests/unit/AuditIntegrity.spec.ts:53
     1  tests/unit/Authorize.spec.ts:77
     5  tests/unit/EvidenceExportService.spec.ts:46
     2  tests/unit/IngressAttestationMiddleware.spec.ts:32
     1  tests/unit/JwtBridge.spec.ts:7
     4  tests/unit/OutboxDispatchService.spec.ts:28
    15  tests/unit/OutboxRelayer.spec.ts:39
     1  tests/unit/PolicyConsistencyMiddleware.spec.ts:63
     4  tests/unit/ShortLivedCertificateManager.spec.ts:63
     2  tests/unit/ZombieRepairWorker.spec.ts:33
mwiza@DESKTOP-VV0116A:~/workspaces/Symphony$